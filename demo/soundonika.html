<!DOCTYPE html>
<!--suppress CssUnusedSymbol, CssRedundantUnit -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundonika Refactored Demo</title>
    <style>
        body {
            font-family: sans-serif;
            background: #111;
            color: #eee;
            padding: 2rem;
            line-height: 1.5;
        }

        h1 {
            color: #8f8;
            margin-bottom: 0.5rem;
        }

        .section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #333;
            border-radius: 8px;
        }

        .implementation-note {
            background: #1a1a2e;
            border-left: 4px solid #4a90e2;
            padding: 0.75rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            border-radius: 0 4px 4px 0;
        }

        .refactor-note {
            background: #2e1a1a;
            border-left: 4px solid #e24a4a;
            padding: 0.75rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            border-radius: 0 4px 4px 0;
        }

        .new-feature {
            background: #1a2e1a;
            border-left: 4px solid #4ae24a;
            padding: 0.75rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            border-radius: 0 4px 4px 0;
        }

        .implementation-note code,
        .refactor-note code,
        .new-feature code {
            background: #2a2a3e;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #8fd3f4;
        }

        button {
            font-size: 1rem;
            margin: 0.25rem;
            padding: 0.6rem 1rem;
            background: #333;
            color: #eee;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #444;
        }

        button:disabled {
            background: #222;
            color: #666;
            cursor: not-allowed;
        }

        .loading {
            background: #444 !important;
            color: #aaa !important;
        }

        .status {
            margin: 1rem 0;
            padding: 0.5rem;
            background: #222;
            border-radius: 4px;
            font-family: monospace;
        }

        .progress {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8f8, #4a4);
            width: 0%;
            transition: width 0.3s ease;
        }

        input[type="range"] {
            width: 200px;
            margin: 0 1rem;
        }

        .timing-demo {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .beat {
            height: 40px;
            background: #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.1s ease;
        }

        .beat.active {
            background: #8f8;
            color: #111;
        }

        .config-display {
            background: #222;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.8rem;
            margin: 1rem 0;
            white-space: pre-wrap;
        }

        .kit-info {
            margin: 1rem 0;
            padding: 0.75rem;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
        }

        .kit-default {
            background: #1a1a2e;
            border-left: 4px solid #4a90e2;
            color: #8fd3f4;
        }

        .kit-vinyl1 {
            background: #2e1a1a;
            border-left: 4px solid #e24a4a;
            color: #f4a58f;
        }

        .kit-vinyl2 {
            background: #1a2e1a;
            border-left: 4px solid #4ae24a;
            color: #8ff48f;
        }
    </style>
</head>
<body>
<h1>üßÉ Soundonika Refactored Demo</h1>
<p>Demonstrating the new configurable architecture and flexible sample mappings</p>

<!-- Refactoring Overview -->
<div class="section">
    <h2>üîß Refactoring Overview</h2>

    <div class="refactor-note">
        <strong>Key Changes:</strong> This demo showcases the refactored Soundonika engine that addresses two critical issues:
        <br>1. <strong>Hard-coded Sample Mappings:</strong> Removed from source code, now configurable via constructor options
        <br>2. <strong>Global Namespace Pollution:</strong> Eliminated window.Soundonika, now uses proper module exports
    </div>

    <div class="new-feature">
        <strong>New Benefits:</strong>
        <br>‚Ä¢ CDN-friendly while working with local Tonika directory structures
        <br>‚Ä¢ Runtime kit switching and custom sample mappings
        <br>‚Ä¢ Modern ES6 module support with backward compatibility
        <br>‚Ä¢ Flexible configuration system for different deployment scenarios
    </div>
</div>

<!-- Initialization Section -->
<div class="section">
    <h2>üöÄ Initialization</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Creates <code>AudioContext</code> and <code>SoundonikaEngine</code> instance with configurable options.
        Calls <code>engine.init()</code> which executes <code>setupAudioGraph()</code>, <code>loadSampleIndex()</code>,
        <code>preloadSamples()</code>, and <code>setupSoundTypeMapping()</code>. Progress tracking uses
        <code>engine.getLoadingProgress()</code> polled every 100ms.
    </div>

    <div class="refactor-note">
        <strong>Refactor Change:</strong> The <code>setupSoundTypeMapping()</code> method now uses configurable mappings
        instead of hard-coded paths. Sample mappings can be provided via constructor options or updated at runtime.
    </div>

    <button id="initBtn">Initialize Engine</button>
    <div class="status" id="initStatus">Not initialized</div>
    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>
</div>

<!-- Basic Controls -->
<div class="section">
    <h2>üéõÔ∏è Basic Controls</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Volume control calls <code>engine.setVolume()</code> which updates
        <code>this.masterGain.gain.value</code> in the Web Audio graph. Mode switching uses
        <code>engine.setSoundMode()</code> to toggle between sample playback and synthesized click sounds.
    </div>

    <label>
        Volume: <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.8">
        <span id="volumeDisplay">0.8</span>
    </label>
    <br><br>
    <label>
        Mode:
        <select id="modeSelect">
            <option value="samples">Samples</option>
            <option value="clicks">Clicks</option>
        </select>
    </label>
</div>

<!-- Immediate Playback -->
<div class="section">
    <h2>üéµ Immediate Playback</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Each button calls <code>engine.scheduleSound(ctx.currentTime, soundType, 1.0)</code>.
        The engine looks up the sound type in <code>this.soundTypeMap</code>, retrieves the corresponding
        <code>AudioBuffer</code> from <code>this.sampleBuffers</code>, creates a <code>BufferSource</code> node,
        and connects it through the audio graph for immediate playback.
    </div>

    <div class="refactor-note">
        <strong>Refactor Change:</strong> Sound type mappings are now dynamically configurable. Try switching kits
        below to hear different samples for the same sound types. The mapping lookup is now flexible and can be
        updated at runtime without modifying source code.
    </div>

    <button onclick="testSound('kick')">Kick</button>
    <button onclick="testSound('snare')">Snare</button>
    <button onclick="testSound('hihat_closed')">Hi-Hat Closed</button>
    <button onclick="testSound('hihat_open')">Hi-Hat Open</button>
    <button onclick="testSound('perc')">Perc</button>
    <button onclick="testSound('shaker')">Shaker</button>
</div>

<!-- Kit Switching Demo -->
<div class="section">
    <h2>ü•Å Runtime Kit Switching</h2>

    <div class="new-feature">
        <strong>New Feature:</strong> The refactored engine supports runtime kit switching via the
        <code>setSampleMappings()</code> method. This was impossible with the old hard-coded approach.
        Sample mappings can be updated without reinitializing the entire engine.
    </div>

    <div class="refactor-note">
        <strong>Working Implementation:</strong> Kit switching now properly loads new samples. The <code>setSampleMappings()</code>
        method is now async and automatically loads any missing samples before completing the switch.
        Visual feedback shows loading states and current kit information.
    </div>

    <div class="implementation-note">
        <strong>Configuration Architecture:</strong> Sample mappings are now passed via constructor options instead of being hard-coded.
        The <code>sampleMappings</code> object defines which sample files to use for each sound type.
        This enables runtime kit switching and custom sample libraries. The configuration display below automatically
        updates to show the current sample mappings whenever a kit switch occurs.
    </div>

    <div class="kit-info kit-default" id="kitInfo">Kit: Not initialized</div>

    <button onclick="switchToVinylKit()">Switch to Vinyl Kit 01</button>
    <button onclick="switchToVinylKit2()">Switch to Vinyl Kit 02</button>
    <button onclick="switchToDefaultKit()">Switch to Default Kit</button>
    <button onclick="testKitSequence()">Test Kit Sequence</button>
    <button id="showConfigBtn">Toggle Configuration Display</button>

    <div class="status" id="kitStatus">Default kit active</div>

    <div class="config-display" id="configDisplay">Engine not initialized</div>
</div>

<!-- Scheduled Playback -->
<div class="section">
    <h2>‚è∞ Scheduled Playback</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Uses Web Audio's precise timing by calling <code>engine.scheduleSound()</code>
        with future timestamps. The <code>source.start(when)</code> method schedules playback at exact audio
        context times. Velocity demo shows how the third parameter controls <code>gainNode.gain.value</code>
        for dynamic volume. Precision timing demonstrates sub-millisecond accuracy.
    </div>

    <button onclick="testScheduledSequence()">Play Scheduled Sequence</button>
    <button onclick="testVelocityDemo()">Velocity Demo</button>
    <button onclick="testPrecisionTiming()">Precision Timing Test</button>
    <div class="status" id="scheduleStatus">Ready for scheduling tests</div>
</div>

<!-- Rhythm Demo -->
<div class="section">
    <h2>ü•Å Rhythm Demo</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Metronome uses <code>setInterval()</code> with BPM-calculated timing
        (60/BPM seconds per beat). Each tick calls <code>engine.scheduleSound()</code> with a small lookahead
        (<code>now + 0.01</code>) for precision. Accent beats use different sound types mapped in
        <code>setupSoundTypeMapping()</code>. Visual indicators update via DOM manipulation synchronized with audio.
    </div>

    <div class="refactor-note">
        <strong>Refactor Change:</strong> The accent and normal beat mappings are now configurable. Different kits
        can define different sounds for accent beats, making the metronome more versatile and customizable.
    </div>

    <button onclick="startMetronome()">Start Metronome</button>
    <button onclick="stopMetronome()">Stop Metronome</button>
    <label>
        BPM: <input type="range" id="bpmSlider" min="60" max="180" value="120">
        <span id="bpmDisplay">120</span>
    </label>
    <div class="timing-demo">
        <div class="beat" id="beat1">1</div>
        <div class="beat" id="beat2">2</div>
        <div class="beat" id="beat3">3</div>
        <div class="beat" id="beat4">4</div>
    </div>
</div>

<!-- Performance Stats -->
<div class="section">
    <h2>üìä Performance Stats</h2>

    <div class="implementation-note">
        <strong>Implementation:</strong> Stats are gathered from engine methods: <code>getLoadedSampleCount()</code>
        returns <code>this.sampleBuffers.size</code>, <code>isReady()</code> checks <code>this.isInitialized</code>,
        and <code>ctx.currentTime</code> shows Web Audio's high-resolution timer. Auto-refresh uses
        <code>setInterval(updateStats, 1000)</code> for real-time monitoring.
    </div>

    <div class="new-feature">
        <strong>New Feature:</strong> Added <code>getSampleMappings()</code> method to inspect current configuration
        and verify that kit switching is working correctly. The stats now show which kit is currently active.
    </div>

    <div class="status" id="statsDisplay">
        Loaded Samples: 0<br>
        Audio Context State: suspended<br>
        Current Time: 0.000s
    </div>
    <button onclick="updateStats()">Refresh Stats</button>
</div>

<script src="../js/soundonika.js"></script>
<script>
    let engine = null;
    let ctx = null;
    let metronomeInterval = null;
    let currentBeat = 0;
    let isMetronomeRunning = false;
    let currentKit = 'default'; // Track current kit
    let configDisplayVisible = true; // Track config display visibility

    // Kit configurations
    const defaultKitConfig = {
        'kick': 'percussion/DopeDrumsVol5/DD5_Kick_01.wav',
        'snare': 'percussion/DopeDrumsVol5/DD5_Snare_01.wav',
        'hihat_closed': 'percussion/DopeDrumsVol5/DD5_CH_01.wav',
        'hihat_open': 'percussion/DopeDrumsVol5/DD5_OH_01.wav',
        'perc': 'percussion/DopeDrumsVol5/DD5_Perc_01.wav',
        'shaker': 'percussion/DopeDrumsVol5/DD5_Shk_01.wav',
        'accent': 'percussion/DopeDrumsVol5/DD5_Kick_01.wav',
        'normal': 'percussion/DopeDrumsVol5/DD5_CH_01.wav'
    };

    const vinylKit1Config = {
        'kick': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_kick.wav',
        'snare': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_snare.wav',
        'hihat_closed': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_hihat1.wav',
        'hihat_open': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_hihat2.wav',
        'perc': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_snare.wav',
        'shaker': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_hihat1.wav',
        'accent': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_kick.wav',
        'normal': 'percussion/VinylDrumKitsVol1/VDK1_Kit01_hihat1.wav'
    };

    const vinylKit2Config = {
        'kick': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_kick.wav',
        'snare': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_snare.wav',
        'hihat_closed': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_hihat1.wav',
        'hihat_open': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_hihat2.wav',
        'perc': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_snare.wav',
        'shaker': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_hihat1.wav',
        'accent': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_kick.wav',
        'normal': 'percussion/VinylDrumKitsVol1/VDK1_Kit02_hihat1.wav'
    };

    // UI Elements
    const initBtn = document.getElementById('initBtn');
    const initStatus = document.getElementById('initStatus');
    const progressBar = document.getElementById('progressBar');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeDisplay = document.getElementById('volumeDisplay');
    const modeSelect = document.getElementById('modeSelect');
    const scheduleStatus = document.getElementById('scheduleStatus');
    const bpmSlider = document.getElementById('bpmSlider');
    const bpmDisplay = document.getElementById('bpmDisplay');
    const statsDisplay = document.getElementById('statsDisplay');
    const configDisplay = document.getElementById('configDisplay');
    const kitStatus = document.getElementById('kitStatus');
    const kitInfo = document.getElementById('kitInfo');
    const showConfigBtn = document.getElementById('showConfigBtn');

    function updateKitDisplay() {
        if (currentKit === 'default') {
            kitInfo.textContent = 'Kit: Default (DopeDrumsVol5)';
            kitInfo.className = 'kit-info kit-default';
        } else if (currentKit === 'vinyl1') {
            kitInfo.textContent = 'Kit: Vinyl Kit 01 (VinylDrumKitsVol1)';
            kitInfo.className = 'kit-info kit-vinyl1';
        } else if (currentKit === 'vinyl2') {
            kitInfo.textContent = 'Kit: Vinyl Kit 02 (VinylDrumKitsVol1)';
            kitInfo.className = 'kit-info kit-vinyl2';
        }

        // AUTO-UPDATE: Update config display whenever kit changes
        updateConfigDisplay();
    }

    function updateConfigDisplay() {
        if (!engine) {
            configDisplay.textContent = 'Engine not initialized';
            return;
        }

        const mappings = engine.getSampleMappings();
        const configText = JSON.stringify(mappings, null, 2);
        configDisplay.textContent = configText;
    }

    // Initialize the engine with configurable options
    initBtn.addEventListener('click', async () => {
        try {
            initBtn.disabled = true;
            initStatus.textContent = 'Initializing...';

            ctx = new AudioContext();

            // Initialize with configurable sample mappings and correct path
            const engineOptions = {
                sampleBasePath: '../samples',  // Correct path for demo directory
                sampleMappings: defaultKitConfig
            };

            engine = new SoundonikaEngine(ctx, engineOptions);

            // Monitor loading progress
            const progressInterval = setInterval(() => {
                const progress = engine.getLoadingProgress();
                progressBar.style.width = (progress * 100) + '%';

                if (progress >= 1) {
                    clearInterval(progressInterval);
                }
            }, 100);

            await engine.init();

            currentKit = 'default';
            updateKitDisplay(); // This will also update config display

            initStatus.textContent = 'Engine initialized successfully!';
            initStatus.style.color = '#8f8';

            // Enable controls
            enableControls();
            updateStats();

        } catch (error) {
            initStatus.textContent = `Initialization failed: ${error.message}`;
            initStatus.style.color = '#f88';
            initBtn.disabled = false;
        }
    });

    // Configuration display toggle
    showConfigBtn.addEventListener('click', () => {
        configDisplayVisible = !configDisplayVisible;
        configDisplay.style.display = configDisplayVisible ? 'block' : 'none';
        showConfigBtn.textContent = configDisplayVisible ? 'Hide Configuration Display' : 'Show Configuration Display';
    });

    // Kit switching functions
    async function switchToVinylKit() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        const targetKit = currentKit === 'vinyl1' ? 'vinyl2' : 'vinyl1';
        const targetConfig = targetKit === 'vinyl1' ? vinylKit1Config : vinylKit2Config;
        const kitName = targetKit === 'vinyl1' ? 'Vinyl Kit 01' : 'Vinyl Kit 02';

        kitStatus.textContent = `Loading ${kitName}...`;

        try {
            console.log(`Switching to ${kitName}...`);
            await engine.setSampleMappings(targetConfig);

            currentKit = targetKit;
            updateKitDisplay(); // This will auto-update both kit info and config display
            kitStatus.textContent = `${kitName} active`;
        } catch (error) {
            kitStatus.textContent = `Failed to load ${kitName}: ${error.message}`;
            console.error('Kit switching error:', error);
        }
    }

    async function switchToVinylKit2() {
        await switchToVinylKit();
    }

    async function switchToDefaultKit() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        kitStatus.textContent = 'Loading Default Kit...';

        try {
            console.log('Switching to Default Kit...');
            await engine.setSampleMappings(defaultKitConfig);

            currentKit = 'default';
            updateKitDisplay(); // This will auto-update both kit info and config display
            kitStatus.textContent = 'Default kit active';
        } catch (error) {
            kitStatus.textContent = `Failed to load Default Kit: ${error.message}`;
            console.error('Kit switching error:', error);
        }
    }

    async function testKitSequence() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        kitStatus.textContent = 'Testing kit sequence...';

        const startTime = ctx.currentTime + 0.1;

        // Play with the current kit
        engine.scheduleSound(startTime, 'kick', 1.0);
        engine.scheduleSound(startTime + 0.5, 'snare', 0.8);

        // Switch to next kit and play after a delay
        setTimeout(async () => {
            await switchToVinylKit();
            engine.scheduleSound(ctx.currentTime, 'kick', 1.0);
            engine.scheduleSound(ctx.currentTime + 0.5, 'snare', 0.8);
            kitStatus.textContent = 'Kit sequence complete';
        }, 1000);
    }

    // Volume control
    volumeSlider.addEventListener('input', () => {
        const volume = parseFloat(volumeSlider.value);
        volumeDisplay.textContent = volume.toFixed(1);
        if (engine) {
            engine.setVolume(volume);
        }
    });

    // Mode control
    modeSelect.addEventListener('change', () => {
        if (engine) {
            engine.setSoundMode(modeSelect.value);
        }
    });

    // BPM control
    bpmSlider.addEventListener('input', () => {
        bpmDisplay.textContent = bpmSlider.value;

        if (isMetronomeRunning) {
            stopMetronome();
            startMetronome();
        }
    });

    function enableControls() {
        volumeSlider.disabled = false;
        modeSelect.disabled = false;
        bpmSlider.disabled = false;
    }

    // Test functions
    function testSound(soundType) {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized. Click "Initialize Engine" first.');
            return;
        }

        engine.scheduleSound(ctx.currentTime, soundType, 1.0);
    }

    function testScheduledSequence() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        scheduleStatus.textContent = 'Playing scheduled sequence...';

        const startTime = ctx.currentTime + 0.1;
        const interval = 0.5;

        engine.scheduleSound(startTime, 'kick', 1.0);
        engine.scheduleSound(startTime + interval, 'snare', 0.8);
        engine.scheduleSound(startTime + interval * 2, 'hihat_closed', 0.6);
        engine.scheduleSound(startTime + interval * 3, 'snare', 0.8);

        setTimeout(() => {
            scheduleStatus.textContent = 'Sequence complete';
        }, interval * 4 * 1000);
    }

    function testVelocityDemo() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        scheduleStatus.textContent = 'Playing velocity demo...';

        const startTime = ctx.currentTime + 0.1;
        const velocities = [0.2, 0.4, 0.6, 0.8, 1.0];

        velocities.forEach((velocity, index) => {
            engine.scheduleSound(startTime + index * 0.3, 'kick', velocity);
        });

        setTimeout(() => {
            scheduleStatus.textContent = 'Velocity demo complete';
        }, velocities.length * 300);
    }

    function testPrecisionTiming() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        scheduleStatus.textContent = 'Testing precision timing...';

        const startTime = ctx.currentTime + 0.1;
        const interval = 0.1;

        for (let i = 0; i < 10; i++) {
            engine.scheduleSound(startTime + i * interval, 'hihat_closed', 0.7);
        }

        setTimeout(() => {
            scheduleStatus.textContent = 'Precision timing test complete';
        }, 10 * interval * 1000);
    }

    function startMetronome() {
        if (!engine || !engine.isReady()) {
            alert('Engine not initialized.');
            return;
        }

        if (metronomeInterval) {
            stopMetronome();
        }

        const bpm = parseInt(bpmSlider.value);
        const interval = 60 / bpm;

        currentBeat = 0;
        isMetronomeRunning = true;

        metronomeInterval = setInterval(() => {
            const now = ctx.currentTime;

            if (currentBeat % 4 === 0) {
                engine.scheduleSound(now + 0.01, 'accent', 1.0);
            } else {
                engine.scheduleSound(now + 0.01, 'normal', 0.7);
            }

            updateBeatIndicator();
            currentBeat++;

        }, interval * 1000);
    }

    function stopMetronome() {
        if (metronomeInterval) {
            clearInterval(metronomeInterval);
            metronomeInterval = null;
            isMetronomeRunning = false;

            for (let i = 1; i <= 4; i++) {
                document.getElementById(`beat${i}`).classList.remove('active');
            }
        }
    }

    function updateBeatIndicator() {
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`beat${i}`).classList.remove('active');
        }

        const beatNumber = (currentBeat % 4) + 1;
        document.getElementById(`beat${beatNumber}`).classList.add('active');
    }

    function updateStats() {
        if (!engine || !ctx) {
            statsDisplay.innerHTML = `
                Loaded Samples: 0<br>
                Audio Context State: not created<br>
                Current Time: 0.000s
            `;
            return;
        }

        const currentKitName = getCurrentKitName();

        statsDisplay.innerHTML = `
            Loaded Samples: ${engine.getLoadedSampleCount()}<br>
            Audio Context State: ${ctx.state}<br>
            Current Time: ${ctx.currentTime.toFixed(3)}s<br>
            Engine Ready: ${engine.isReady()}<br>
            Current Mode: ${engine.getSoundMode()}<br>
            Volume: ${engine.getVolume().toFixed(2)}<br>
            Active Kit: ${currentKitName}<br>
            Metronome: ${isMetronomeRunning ? 'Running' : 'Stopped'}<br>
            BPM: ${bpmSlider.value}
        `;
    }

    function getCurrentKitName() {
        if (!engine) return 'None';

        const mappings = engine.getSampleMappings();
        const kickSample = mappings.kick;

        if (kickSample && kickSample.includes('DopeDrumsVol5')) {
            return 'Default (DopeDrumsVol5)';
        } else if (kickSample && kickSample.includes('VDK1_Kit01')) {
            return 'Vinyl Kit 01';
        } else if (kickSample && kickSample.includes('VDK1_Kit02')) {
            return 'Vinyl Kit 02';
        } else {
            return 'Custom';
        }
    }

    // Auto-update stats every second
    setInterval(updateStats, 1000);

    // Auto-test sequence (press 't' key)
    document.addEventListener('keydown', (event) => {
        if (event.key === 't' && engine && engine.isReady()) {
            console.log('Starting auto-test sequence...');
            testKitSequence();
        }
    });
</script>

<p style="color: #666; font-size: 0.8rem; margin-top: 2rem;">
    Tip: Press 't' key for auto-test sequence (play ‚Üí switch kit ‚Üí play)
</p>
</body>
</html>

